var pkfronters=function(l){"use strict";const U=(r,e={},t=[])=>{const s=typeof r=="function"?r(e):Object.assign(document.createElement(r),e);return Array.isArray(t)||(t=[t]),s.append(...t),s},y=r=>{for(;r.lastChild;)r.removeChild(r.lastChild)},I=r=>Array.from(document.querySelectorAll(r)),G=(r="",e={})=>{let t=new URL(r,window.location.href);return Object.entries(e).forEach(s=>{let[a,n]=s;t.searchParams.set(a,n)}),t.toString()},o=(r,e,...t)=>{e=e!==null?e:{};let s=e.class||void 0;delete e.class;let a=e.style||{};delete e.style;let n=e.dataset||{};delete e.dataset;const c=U(r,e,t);return s!==void 0&&(c.classList.value=s),Object.assign(c.style,a),Object.assign(c.dataset,n),c},K=/^https:\/\/cdn\.discordapp\.com\/attachments\/([^?]+)/i,O=(r,e=256,t="webp")=>{e=typeof e=="number"?[e,e]:e;let s;return(s=K.exec(r))!==null&&(r=G(`https://media.discordapp.net/attachments/${s[1]}`,{width:e[0],height:e[1],format:t})),r},D=r=>O(r,256,"webp");class A{constructor(){this._cache={}}CacheResponse(e,t){this._cache[e.join("/")]=t}GetCachedResponse(e){const t=e.join("/");return t in this._cache?this._cache[t]:null}}class _{constructor(e,t,s){this.code=e,this.message=t,this.errors=s}}var S=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},w=(r,e,t)=>(S(r,e,"read from private field"),t?t.call(r):e.get(r)),P=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},B=(r,e,t,s)=>(S(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),v=(r,e,t)=>new Promise((s,a)=>{var n=i=>{try{u(t.next(i))}catch(p){a(p)}},c=i=>{try{u(t.throw(i))}catch(p){a(p)}},u=i=>i.done?s(i.value):Promise.resolve(i.value).then(n,c);u((t=t.apply(r,e)).next())}),h,m;const N="https://api.pluralkit.me/v2",H="https://api.beta.pluralkit.me/v2";class R{constructor(e=null,t=N){P(this,h,void 0),P(this,m,void 0),B(this,h,e),this.apiBase=t}setCache(e){B(this,m,e)}withCache(e){return this.setCache(e),this}finalUrl(e){return this.apiBase+"/"+e.join("/")}deriveHeaders(){var e={Accept:"application/json"};return w(this,h)!==null&&(e.Authorization=w(this,h)),e}get(e){return v(this,null,function*(){const t=w(this,m).GetCachedResponse(e);if(t!==null)return console.log(`returning cached response for ${"/"+e.join("/")}`),t;const s=this.finalUrl(e),a=yield window.fetch(s,{method:"GET",headers:this.deriveHeaders()}),n=yield a.json();if(!a.ok)throw new _(n.code,n.message,n.errors);return w(this,m).CacheResponse(e,n),n})}GetSystem(e="@me"){return v(this,null,function*(){return yield this.get(["systems",e])})}GetSystemMembers(e="@me"){return v(this,null,function*(){return yield this.get(["systems",e,"members"])})}GetSystemFronters(e="@me"){return v(this,null,function*(){return(yield this.get(["systems",e,"fronters"])).members})}}h=new WeakMap,m=new WeakMap;const W=new A;new R().withCache(W);class d{constructor(e,t){this.regex=e,this.replacement=t}apply(e){return e.replace(this.regex,this.replacement)}}class f{constructor(e,t){this.name=e,this.patterns=t}apply(e){return this.patterns.reduce((t,s)=>s.apply(t),e)}}const F=[new f("bold",[new d(/\*\*\s?([^\n]+)\*\*/g,"<strong>$1</strong>"),new d(/\_\_\s?([^\n]+)\_\_/g,"<strong>$1</strong>")]),new f("italic",[new d(/\*\s?([^\n]+)\*/g,"<em>$1</em>"),new d(/\_\s?([^\n]+)\_/g,"<em>$1</em>")]),new f("link",[new d(/\[([^\n]+)\]\(\<?([^\>\n]+)\>?\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>')]),new f("paragraph",[new d(/([^\n]+\n?)/g,`
<p>$1</p>
`)]),new f("linebreak",[new d(/\n(?!\n)/g,"<br>")])];class ${constructor(e=null){this.rules=e||Array.from(F)}addRuleBefore(e,t){const s=this.rules.findIndex(a=>a.name===t);return s!==-1&&this.rules.splice(s,0,e),this}addRule(e){return this.addRuleBefore(e,"paragraph"),this}removeRule(e){const t=this.rules.findIndex(s=>s.name===e);return t!==-1&&this.rules.splice(t,1),this}render(e){return this.rules.reduce((t,s)=>s.apply(t),e)}}var L=(r,e,t)=>new Promise((s,a)=>{var n=i=>{try{u(t.next(i))}catch(p){a(p)}},c=i=>{try{u(t.throw(i))}catch(p){a(p)}},u=i=>i.done?s(i.value):Promise.resolve(i.value).then(n,c);u((t=t.apply(r,e)).next())});const T=new $().removeRule("paragraph");new $;let b=new R(null,N).withCache(new A);var k=(r=>(r[r.LIST=0]="LIST",r[r.CARD=1]="CARD",r))(k||{});class g{constructor(){this.pronouns=!0,this.displayNames=!1,this.cardBorder="inner",this.useNewCard=!1,this.fallbackAvatarUrl=null}parseString(e){for(const t of e.matchAll(/(!?)([^\s,]+)/g)){const s=t[1]!=="!";switch(t[2]){case"card_border_outer":case"cbo":this.cardBorder=s?"outer":"inner";break;case"pronouns":case"prns":this.pronouns=s;break;case"displayname":case"dn":this.displayNames=s;break;case"newcard":case"nc":this.useNewCard=s;break}}return this}toString(){const e=(s,a,n)=>this[a]!=new g()[a]?n?s:"!"+s:null;let t=[];return t.push(e("prns","pronouns",this.pronouns)),t.push(e("dn","displayNames",this.displayNames)),t.push(e("cbo","cardBorder",this.cardBorder==="outer")),t.push(e("nc","useNewCard",this.useNewCard)),t.filter(s=>s!==null).join(",")}fallbackAvatar(e){if(this.fallbackAvatarUrl!==null)return this.fallbackAvatarUrl;let t=0;for(let s=0;s<e.length;s++){const a=e.charCodeAt(s);t=(t<<5)-t+a,t&=t}return`https://cdn.discordapp.com/embed/avatars/${(Math.abs(t)%5).toString()}.png`}}const z=(r,e)=>({borderColor:e.useNewCard||e.cardBorder==="outer"?"#"+(r.color||"000"):void 0}),q=(r,e)=>({borderColor:!e.useNewCard&&e.cardBorder==="inner"?"#"+(r.color||"000"):void 0,borderWidth:e.useNewCard||e.cardBorder==="outer"?"0px":void 0,backgroundImage:`url(${D(r.webhook_avatar_url||r.avatar_url||e.fallbackAvatar(r.uuid))})`,backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"cover"}),J=(r,e)=>o("div",{class:"pkfronters--member-card"+(e.useNewCard?" pkfronters--newcard":""),style:z(r,e)},o("div",{class:"pkfronters--member-card--avatar",style:q(r,e)}),o("strong",{class:"pkfronters--member-card--name"},e.displayNames&&r.display_name||r.name),e.pronouns&&r.pronouns!==null?o("span",{class:"pkfronters--member-card--pronouns",innerHTML:T.render(r.pronouns)}):""),j=(r,e,t)=>{y(r),r.classList="pkfronters--member-card-container"+(t.useNewCard?" pkfronters--newcard":""),r.append(...e.map(s=>J(s,t)))},Q=(r,e)=>o("li",null,o("strong",{class:"pkfronters--member-list--name"},e.displayNames&&r.display_name||r.name),e.pronouns&&r.pronouns!==null?o("span",{class:"pkfronters--member-list--pronouns",innerHTML:T.render(r.pronouns)}):""),x=(r,e,t)=>{y(r),r.append(o("ul",{class:"pkfronters--member-list"},...e.map(s=>Q(s,t))))},E=(r,e,t,s)=>L(void 0,null,function*(){y(e),e.append(o("div",{class:"pkfronters--loading"},"Loading fronters for PluralKit system ",o("code",null,r),"\u2026"));try{const n=yield b.GetSystemFronters(r);switch(t){case 1:j(e,n,s);break;case 0:x(e,n,s);break}}catch(n){console.log(n);var a=o("span",{class:"pkfronters--error-details"},"Exception: ",n.message);n instanceof _&&(a=o("span",{class:"pkfronters--error-details"},"PluralKit returned error code ",o("code",null,n.code),":\xA0",n.message)),y(e),e.append(o("div",{class:"pkfronters--error"},"Failed to load fronters for system ",o("code",null,r),":\xA0",a))}}),M=()=>L(void 0,null,function*(){yield Promise.all(I("[data-pkfronters-system]").map(r=>{let e=new g().parseString(r.dataset.pkfrontersOptions||""),t=k[(r.dataset.pkfrontersType||"LIST").toUpperCase()];return E(r.dataset.pkfrontersSystem,r,t,e)}))});if(typeof document.currentScript.dataset.pkfrontersApiBase=="string"){var C=document.currentScript.dataset.pkfrontersApiBase;C==="beta"&&(C=H),b.apiBase=C}return typeof document.currentScript.dataset.pkfrontersNoauto!="string"&&setTimeout(0,M()),l.DisplayType=k,l.Options=g,l.PKClient=b,l.render=E,l.renderAll=M,l.renderCards=j,l.renderList=x,l}({});
//# sourceMappingURL=pkfronters.js.map
